<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Care Bot</title>
  </head>
  <body>
    <h1>Care Bot</h1>
    <section id="user-prompt-section">
      <form id="user-prompt-form" method="post">
        <fieldset>
          <legend id="user-prompt-legend">How are you feeling today?</legend>
          <button
            id="happy-button"
            aria-label="Happy"
            name="mood"
            value="happy"
          >
            üôÇ I'm Feeling Positive
          </button>
          <button
            id="sad-button"
            aria-label="Sad"
            type="submit"
            name="mood"
            value="sad"
          >
            üôÅ I'm Feeling Negative
          </button>
          <textarea id="spoken-mood" name="mood" id=""></textarea>
          <button id="spoken-mood-submit" type="submit">üì® Submit Mood</button>
          <button id="speak-mood" type="button">üé§ I'll Speak My Mood</button>
        </fieldset>
      </form>
    </section>
    <div id="loading">Loading...</div>
    <div id="im-listening">I'm listening...</div>
    <section id="program-container"></section>
    <audio controls id="audio-source">
      <source src="./synthesis.wav" type="audio/mp3" />
      Your browser does not support the audio element.
    </audio>
    <script src="./index.ts" type="module"></script>

    <script>
      if (
        !("SpeechRecognition" in window || "webkitSpeechRecognition" in window)
      ) {
        console.log("Your browser does not support the SpeechRecognition API");
      }

      const userPromptSection = document.getElementById("user-prompt-section");
      const listeningSection = document.getElementById("im-listening");

      listeningSection.style.display = "none";

      const recognition = new (window.SpeechRecognition ||
        window.webkitSpeechRecognition)();

      recognition.onresult = function (event) {
        userPromptSection.style.display = "block";
        listeningSection.style.display = "none";
        const transcript = event.results[0][0].transcript;
        console.log("You said: " + transcript);

        const spokenMood = document.getElementById("spoken-mood");
        const happyButton = document.getElementById("happy-button");
        const sadButton = document.getElementById("sad-button");
        const spokenMoodSubmit = document.getElementById("spoken-mood-submit");

        happyButton.style.display = "none";
        sadButton.style.display = "none";
        spokenMood.style.display = "block";
        spokenMoodSubmit.style.display = "flex";
        spokenMood.value = transcript;
      };

      recognition.onerror = function (event) {
        console.log("Error occurred in recognition: " + event.error);
      };

      const speakMoodButton = document.getElementById("speak-mood");

      if (!speakMoodButton) {
        console.log('Could not find the "Speak Mood" button');
      }

      speakMoodButton.addEventListener("click", function () {
        console.log("Speak Mood button clicked");
        userPromptSection.style.display = "none";
        listeningSection.style.display = "block";
        recognition.start();
      });
    </script>

    <script></script>
  </body>
</html>
