import{q as u}from"./utils-687b3132.js";const I={local:{WORKER_BASE_URL:"http://localhost:8787",CLIENT_BASE_URL:"http://localhost:5173"},production:{WORKER_BASE_URL:"https://llm-cache-worker.tannermichaelgaucher.workers.dev",CLIENT_BASE_URL:"care-bot.netlify.app/"}},v="production",{WORKER_BASE_URL:L,CLIENT_BASE_URL:U}=I[v],_="#loading-indicator",b="#program-container",O="audio",i=u(document,O),R=u(document,_),m=u(document,b);function $({data:t,programContainer:e}){e.innerHTML="";let n=0;function c(d){return d.split(" ").map(a=>{const l=document.createElement("span");return l.id=`${n++}`,l.textContent=a,l})}function o(d,a){a.forEach(l=>{d.appendChild(l),d.appendChild(document.createTextNode(" "))})}const s=document.createElement("p");o(s,c(t.intro)),e.appendChild(s),e.appendChild(document.createElement("hr"));const r=document.createElement("h2");o(r,c(`${t.morning.period} ${t.morning.step.careType}`)),e.appendChild(r);const h=document.createElement("p");o(h,c(t.morning.step.text)),e.appendChild(h),e.appendChild(document.createElement("hr"));const E=document.createElement("h2");o(E,c(`${t.afternoonEvening.period} ${t.afternoonEvening.step.careType}`)),e.appendChild(E);const T=document.createElement("p");o(T,c(t.afternoonEvening.step.text)),e.appendChild(T),e.appendChild(document.createElement("hr"));const f=document.createElement("h2");o(f,c(`${t.night.period} ${t.night.step.careType}`)),e.appendChild(f);const y=document.createElement("p");o(y,c(t.night.step.text)),e.appendChild(y),e.appendChild(document.createElement("hr"));const g=document.createElement("p");o(g,c(t.outro)),e.appendChild(g)}function C(t){const e=[];return t.forEach(n=>{var c;(c=n.alternatives)==null||c.forEach(o=>{var s;(s=o.words)==null||s.forEach(r=>{!r.startTime||!r.endTime||!r.word||e.push({startTime:parseFloat(`${r.startTime.seconds}.${r.startTime.nanos}`.replace("s","")),endTime:parseFloat(`${r.endTime.seconds}.${r.endTime.nanos}`.replace("s","")),word:r.word})})})}),e}function k({transcriptWords:t}){let e=0,n=null;clearInterval(n),document.querySelectorAll('span[spoken="true"]').forEach(o=>{o.removeAttribute("spoken")}),n=setInterval(()=>{const o=i.currentTime,s=t[e];o>=s.startTime&&p(e),o>=s.endTime&&e++,e>=t.length&&(p(e),p(e+1),clearInterval(n))},30)}function p(t){const e=document.getElementById(`${t}`),n=document.querySelector('span[current="true"]');n==null||n.removeAttribute("current"),e==null||e.setAttribute("current","true"),e==null||e.setAttribute("spoken","true"),e==null||e.scrollIntoView({behavior:"auto",block:"center",inline:"center"})}function S(t){$({data:t,programContainer:m}),i.src=t.speechUrl,i.load(),i.play(),i.addEventListener("play",()=>k({transcriptWords:C(t.transcriptionResult)}))}function A(t){t?(i.style.display="none",m.style.display="none",document.body.setAttribute("loading","true"),R.style.display="block"):(document.body.removeAttribute("loading"),R.style.display="none",i.style.display="block",m.style.display="block")}x();async function x(){const e=new URLSearchParams(window.location.search).get("mood");e&&(A(!0),await fetch(`${L}/create-program`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mood:e})}).then(n=>n.json()).then(n=>{S(n)}).catch(n=>console.error("Error:",n)),A(!1))}
