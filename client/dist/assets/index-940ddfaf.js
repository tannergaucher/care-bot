const A={local:{WORKER_BASE_URL:"http://localhost:8787",CLIENT_BASE_URL:"http://localhost:5173"},production:{WORKER_BASE_URL:"https://llm-cache-worker.tannermichaelgaucher.workers.dev",CLIENT_BASE_URL:"care-bot.netlify.app/"}},k="production",{WORKER_BASE_URL:N,CLIENT_BASE_URL:te}=A[k];function s(t,e){const n=t.querySelector(e);if(!n)throw new Error(`Could not find element with selector: ${e}`);return n}const B="form",P="fieldset",U="audio",$="#loading-indicator",x="#spoken-mood-text",M="#program-container",D="#happy-button",F="#sad-button",K="#user-prompt-section",q="#speak-mood-button",W="#spoken-mood-submit-button",G="#im-listening",T=s(document,B),b=s(T,P),l=s(document,U),h=s(document,$),p=s(document,x),y=s(document,M),j=s(document,D),H=s(document,F),C=s(document,K),J=s(document,q),w=s(document,W),f=s(document,G);function V({data:t,programContainer:e}){e.innerHTML="";let n=0;function o(m){return m.split(" ").map(E=>{const a=document.createElement("span");return a.id=`${n++}`,a.textContent=E,a})}function c(m,E){E.forEach(a=>{m.appendChild(a),m.appendChild(document.createTextNode(" "))})}const d=document.createElement("p");c(d,o(t.intro)),e.appendChild(d),e.appendChild(document.createElement("hr"));const i=document.createElement("h2");c(i,o(`${t.morning.period} ${t.morning.step.careType}`)),e.appendChild(i);const S=document.createElement("p");c(S,o(t.morning.step.text)),e.appendChild(S),e.appendChild(document.createElement("hr"));const O=document.createElement("h2");c(O,o(`${t.afternoonEvening.period} ${t.afternoonEvening.step.careType}`)),e.appendChild(O);const R=document.createElement("p");c(R,o(t.afternoonEvening.step.text)),e.appendChild(R),e.appendChild(document.createElement("hr"));const _=document.createElement("h2");c(_,o(`${t.night.period} ${t.night.step.careType}`)),e.appendChild(_);const L=document.createElement("p");c(L,o(t.night.step.text)),e.appendChild(L),e.appendChild(document.createElement("hr"));const g=document.createElement("p");c(g,o(t.outro)),e.appendChild(g)}function X(t){const e=[];return t.forEach(n=>{var o;(o=n.alternatives)==null||o.forEach(c=>{var d;(d=c.words)==null||d.forEach(i=>{!i.startTime||!i.endTime||!i.word||e.push({startTime:parseFloat(`${i.startTime.seconds}.${i.startTime.nanos}`.replace("s","")),endTime:parseFloat(`${i.endTime.seconds}.${i.endTime.nanos}`.replace("s","")),word:i.word})})})}),e}function Y({transcriptWords:t}){let e=0,n=null;clearInterval(n),n=setInterval(()=>{const o=l.currentTime,c=t[e];o>=c.startTime&&I(e),o>=c.endTime&&e++,e>=t.length&&(I(e),clearInterval(n))},30)}function I(t){const e=document.getElementById(`${t}`),n=document.querySelector('span[current="true"]');n==null||n.removeAttribute("current"),e==null||e.setAttribute("current","true"),e==null||e.scrollIntoView({behavior:"auto",block:"center",inline:"center"})}function z(t){V({data:t,programContainer:y}),l.src=t.speechUrl,l.load(),l.play(),l.addEventListener("play",()=>Y({transcriptWords:X(t.transcriptionResult)}))}function v(t){t?(b.disabled=!0,document.body.setAttribute("loading","true"),T.style.display="none",h.style.display="block"):(b.disabled=!1,document.body.removeAttribute("loading"),h.style.display="none",l.style.display="block",y.style.display="block")}async function Q({mood:t}){v(!0),await fetch(`${N}/create-program`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mood:t})}).then(e=>e.json()).then(e=>{z(e)}).catch(e=>console.error("Error:",e)),v(!1)}function Z(t){f.style.display="none",j.style.display="none",H.style.display="none",C.style.display="block",p.style.display="block",w.style.display="flex";const e=t.results[0][0].transcript;p.value=e}let u=null;u===null&&[y,h,l,p,w,f].forEach(t=>{t.style.display="none"});const ee=document.querySelectorAll('button[name="mood"]');ee.forEach(t=>{t.addEventListener("click",()=>{u=t.value})});let r=null;"SpeechRecognition"in window&&(r=new window.SpeechRecognition);"webkitSpeechRecognition"in window&&(r=new window.webkitSpeechRecognition);r&&(r.onresult=function(t){Z(t)});J.addEventListener("click",()=>{C.style.display="none",f.style.display="block",r==null||r.start()});T.addEventListener("submit",async t=>{if(t.preventDefault(),p.value&&(u=p.value),!u)throw new Error("No user mood selected.");Q({mood:u})});
